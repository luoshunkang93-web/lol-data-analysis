name: Daily Data Update ðŸ¤–

# Trigger: Define when this workflow runs
on:
  schedule:
    # Run at 00:00 UTC daily (which is morning in China/US)
    - cron: '0 0 * * *'
  workflow_dispatch: # Allows manual triggering from GitHub Actions tab for testing

jobs:
  update_data:
    runs-on: ubuntu-latest # Use the latest Ubuntu environment

    steps:
    # 1. Checkout the repository content
    - name: Checkout code
      uses: actions/checkout@v3

    # 2. Setup Python environment
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    # 3. Install Python dependencies
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    # 4. Execute the ETL script
    - name: Run Update Script
      env: 
        DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
      run: python update_db.py

    # 5. Commit and push the updated database back to the repo
    - name: Commit and push changes
      run: |
        git config --global user.name "GitHub Action Bot"
        git config --global user.email "actions@github.com"
        git add lol_analysis.db
        # Only commit if there are changes; otherwise, exit gracefully
        git commit -m "ðŸš¨ Auto-update database data" || exit 0
        git pull --rebase origin main  # Pull latest changes to avoid conflicts
        git push